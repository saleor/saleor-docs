---
sidebar_label: Configuration
sidebar_position: 3
title: Adyen App Configuration
---

import Video from "@site/components/Video";

For Adyen to appear as an available payment gateway, you need to [install it in the Saleor Dashboard](/developer/app-store/overview.mdx#usage). You must obtain the API key from Adyen and paste it into the Adyen App configuration form. Then, a wizard will guide you through the process of configuring the Adyen App, setting up the webhook to receive notifications from Adyen, generating the HMAC key, and adding allowed origins for the Client Key that's used on your Storefront.

## Configuring Adyen

Video introduction to Adyen configuration in Saleor:

<Video src="https://www.youtube.com/embed/IhaDSml22Dc" />

You can install the Adyen app directly from your Saleor Dashboard. Go to the **Apps** section and click the **Install** button next to the Adyen app. Follow the instructions on the screen. After the installation is complete, select the Adyen app from the list of installed applications.

### Creating new API Credentials

To create new Adyen API credentials, head over to the Adyen dashboard, then **Developers -> API credentials**. Click **Create new credential** and choose **Web service user**.

In **Server settings -> Authentication** section generate a new API key.

In **Client settings -> Authentication** section generate a new client key.

:::caution
The API Key provided inside the configuration must have the following permissions set in the Adyen Dashboard:

- "Management API - Accounts read and write"
- "Management API - API credentials read and write"
- "Management API - Payment methods read"
- "Management API - Stores read and write"
- "Management API - Webhooks read and write"
- "Checkout encrypted cardholder data"
- "Merchant Recurring role"
- "Checkout webservice role"
- "Merchant PAL Webservice role"
:::

Go back to the Adyen app configuration in the Saleor Dashboard. Provide a configuration name that you will be familiar with. In the **API Key** field provide the key from **Server settings -> Authentication** section. Select **TEST** environment.

:::caution
The configuration will not work until you save API credentials in the Adyen dashboard.
:::

Save API credentials in the Adyen dashboard, head over to the Adyen app configuration, and click **Save**. The rest of the form fields have been enabled.

In the **Client key** field, provide a key from the **Client settings -> Authentication** section. Select the merchant account you want to use from the drop-down.

### Webhook configuration

#### Prerequisites

:::caution
Before you begin configuration, make sure that you have disabled the **Delayed Capture** option in the Adyen Dashboard. Read more details on how to do this on the [Overview docs page](./overview.mdx)
:::

In the Adyen dashboard, first go to **Developers -> Additional data**. Click on the following checkboxes:
- `Card summary`
- `Expiry date`
- `Subvariant`
- `Variant`
- `Co-brand`
- `Bank summary`
- `Authorization amount`
- `Authorisation amount (dynamic zero authorisation)`
- `Recurring contract information`
- `Merchant reference`

Your "Response preview" should look like this:

```json
{
    "additionalData": {
        "cardSummary": "1111",
        "expiryDate": "8/2018",
        "paymentMethodVariant": "visadebit",
        "paymentMethod": "visa",
        "coBrandedWith": "visa",
        "bankSummary": "1111",
        "authorisedAmountCurrency": "EUR",
        "authorisedAmountValue": "1000",
        "recurring.contractTypes": "RECURRING,ONECLICK",
        "recurring.recurringDetailReference": "111111",
        "recurring.firstPspReference": "111111",
        "merchantReference": "ref_1234"
    }
}
```

Click the "Save configuration" button to save your settings.

:::tip
Adyen webhook will set `TransactionItem` metadata based on fields received in `NotifiactionItem.additionalData`.

To configure additional fields that will be set when users make payments, go to `Developers > Additional data` and choose fields you want to have in your metadata. Read more about this on the [Architecture docs page](./architecture.mdx#transactionitem-metadata)
:::

:::warning
Setting following fields is required for app to send `TransactionItem.paymentMethodDetails`:
- `Card summary`
- `Expiry date`
- `Subvariant`
- `Variant`
- `Co-brand`
- `Bank summary`
:::

:::danger
Setting following fields is required for app **to properly process payments**:
- `Authorization amount`
- `Authorisation amount (dynamic zero authorisation)`
- `Merchant reference`
:::


#### Configuring the webhook

Then head over to **Developers -> Webhooks**. Click the **+ Webhook** button and choose **Standard webhook**. Provide a description for the webhook.

In the **Server configuration** section, provide the URL the Saleor Adyen app has generated for you. You can copy it from the **Webhook URL** input in the Adyen configuration form. Leave the default settings and click **Apply**.

In **Merchant accounts** select **Include only specific merchant accounts** and choose the merchant accounts that are used in Adyen App

:::caution
Do not select merchant accounts that are used for payments made outside of Adyen App (e.g. POS, custom apps, etc.)
:::

In **Events**, make sure that you have selected the following events:

:::tip
For quick configuration you can just follow these steps:
- deselect events:
  - `ORDER_OPENED`
  - `AUTORESCUE`
  - `CANCEL_AUTORESCUE`
  - `PAIDOUT_REVERSED`
  - `PAYOUT_DECLINE`
  - `PAYOUT_EXPIRE`
  - `REPORT_AVAILABLE`
  - `PAYOUT_THIRDPARTY`
- select events:
  - `EXPIRE`
  - `OFFER_CLOSED`

Note that Adyen might add new webhook events or change default selection in the future, check list below to ensure that all required webhooks are selected.
:::

- `AUTHORISATION`
- `AUTHORISATION_ADJUSTMENT`
- `CANCEL_OR_REFUND`
- `CANCELLATION`
- `CAPTURE`
- `CAPTURE_FAILED`
- `CHARGEBACK`
- `CHARGEBACK_REVERSED`
- `EXPIRE`
- `HANDLED_EXTERNALLY`
- `MANUAL_REVIEW_ACCEPT`
- `MANUAL_REVIEW_REJECT`
- `NOTIFICATION_OF_CHARGEBACK`
- `NOTIFICATION_OF_FRAUD`
- `OFFER_CLOSED`
- `ORDER_CLOSED`
- `POSTPONED_REFUND`
- `PREARBITRATION_LOST`
- `PREARBITRATION_WON`
- `RECURRING_CONTRACT`
- `REFUND`
- `REFUND_FAILED`
- `REFUND_WITH_DATA`
- `REFUNDED_REVERSED`
- `REQUEST_FOR_INFORMATION`
- `SECOND_CHARGEBACK`
- `VOID_PENDING_REFUND`

In **Additional settings -> Card** select:
- `Include card info for recurring contract events`

In **Additional settings -> Payment** select:
- `Include a success boolean for the payments listed in an ORDER_CLOSED event`
- `Include Authorised Amount (dynamic zero auth)`
- `Include Capture Delay Hours`
- `Include Mandate Details`
- `Include Shopper Interaction`
- `Include zero auth flag`

In **Additional settings -> Risk** select:
- `Add capture reference to dispute event`
- `Include the originalReference for CHARGEBACK_REVERSED events`

In **Security -> Basic authentication** provide a username and a password.
Use the same username and password in the **webhook username** and **webhook password** fields in the Adyen application.

Generate a new **HMAC key** in the **Security -> HMAC Key** section and copy it.

Apply the configuration details in the Saleor Adyen app, then in the Adyen dashboard save the new Adyen webhook.
Save the configuration. If everything went well, you should see a new button **Make test webhook call**. Use it to test if your configuration is correct.
