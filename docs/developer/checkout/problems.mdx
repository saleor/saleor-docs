---
title: Problems
---

## Introduction

:::info

This feature was introduced in **Saleor 3.15**.

:::

:::caution

This feature is in the **Feature Preview** stage, which means that it is available for experimentation and
feedback. However, it is still undergoing development and is subject to modifications.

:::

During processing checkout, some problems might occur. Some of them would need to be solved before placing the order.
Saleor aggregates existing checkout problems:

- Field [CheckoutLine.problems](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--) returns a list of problems
  related to a specific [CheckoutLine](api-storefront/checkout/objects/checkout-line.mdx).
- Field [Checkout.problems](api-storefront/checkout/objects/checkout.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--) returns a
  list of all problems related to the checkout and [CheckoutLine.problems](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--)
  from all checkout's lines.

Each `problem` may require different actions from the customer.

:::info

Not all potential problems are already ported to `problems` field. See the list below.
The list of supported `problems` will be extended in future releases.

:::

## Checkout.problems

[Checkout.problems](api-storefront/checkout/objects/checkout.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--) contains the list of all problems
that occurred for the checkout. It also includes the problems that are related to specific lines.

The example below shows query that fetches a [Checkout.problems](api-storefront/checkout/objects/checkout.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--).

```graphql
query checkout($id: ID) {
  checkout(id: $id) {
    id
    problems {
      __typename
      ... on CheckoutLineProblemInsufficientStock {
        availableQuantity
        variant {
          id
        }
        line {
          id
        }
      }
      ... on CheckoutLineProblemVariantNotAvailable {
        line {
          id
        }
      }
    }
  }
}
```

## CheckoutLine.problems

[CheckoutLine.problems](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--) contains the list of problems
that are strictly related to the specific checkout line.
The list of problems will be also attached to [Checkout.problems](api-storefront/checkout/objects/checkout.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--) field.

The example below shows query that fetches a [CheckoutLine.problems](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--).

```graphql
query checkout($id: ID) {
  checkout(id: $id) {
    id
    lines {
      id
      problems {
        __typename
        ... on CheckoutLineProblemInsufficientStock {
          availableQuantity
          variant {
            id
          }
          line {
            id
          }
        }
        ... on CheckoutLineProblemVariantNotAvailable {
          line {
            id
          }
        }
      }
    }
  }
}
```

## Problem types

### CheckoutLineProblemInsufficientStock

[CheckoutLineProblemInsufficientStock](api-storefront/checkout/objects/checkout-line-problem-insufficient-stock.mdx) - defines the problem where there is not enough stock
for the [quantity](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutlinebquantitybcodeint--) assigned to [CheckoutLine](api-storefront/checkout/objects/checkout-line.mdx).
Until resolving the problem, placing the order will not be possible. Mutation for finalizing the checkout like [checkoutComplete](api-storefront/checkout/mutations/checkout-complete.mdx) will return an error [INSUFFICIENT_STOCK](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebinsufficient_stockbcode).
The quantity should be reduced to the value that is less or equal to [CheckoutLineProblemInsufficientStock.availableQuantity](api-storefront/checkout/objects/checkout-line-problem-insufficient-stock.mdx#code-style-fontweight-normal-checkoutlineprobleminsufficientstockbavailablequantitybcodeint-).

```graphql
query checkout($id: ID) {
  checkout(id: $id) {
    id
    problems {
      __typename
      ... on CheckoutLineProblemInsufficientStock {
        availableQuantity
        variant {
          id
        }
        line {
          id
        }
      }
    }
    lines {
      id
      problems {
        __typename
        ... on CheckoutLineProblemInsufficientStock {
          availableQuantity
          variant {
            id
          }
          line {
            id
          }
        }
      }
    }
  }
}
```

### CheckoutLineProblemVariantNotAvailable

[CheckoutLineProblemVariantNotAvailable](api-storefront/checkout/objects/checkout-line-problem-variant-not-available.mdx) - defines the problem where
the attached [variant](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutlinebvariantbcodeproductvariant--) to
[CheckoutLine](api-storefront/checkout/objects/checkout-line.mdx) is not available for purchase. Until resolving the problem, placing the order will not be possible.
Mutation for finalizing the checkout like [checkoutComplete](api-storefront/checkout/mutations/checkout-complete.mdx) will return one of the errors:
[PRODUCT_NOT_PUBLISHED](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebproduct_not_publishedbcode),
[PRODUCT_UNAVAILABLE_FOR_PURCHASE](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebproduct_unavailable_for_purchasebcode),
[UNAVAILABLE_VARIANT_IN_CHANNEL](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebunavailable_variant_in_channelbcode).

```graphql
query checkout($id: ID) {
  checkout(id: $id) {
    id
    problems {
      __typename
      ... on CheckoutLineProblemInsufficientStock {
        availableQuantity
        variant {
          id
        }
        line {
          id
        }
      }
      ... on CheckoutLineProblemVariantNotAvailable {
        line {
          id
        }
      }
    }
    lines {
      id
      problems {
        __typename
        ... on CheckoutLineProblemInsufficientStock {
          availableQuantity
          variant {
            id
          }
          line {
            id
          }
        }
        ... on CheckoutLineProblemVariantNotAvailable {
          line {
            id
          }
        }
      }
    }
  }
}
```

## Control error flow

In the current way of error handling, some mutations can raise an error that is not related to the requested action.
For example, [checkoutShippingAddressUpdate](api-storefront/checkout/mutations/checkout-shipping-address-update.mdx) can raise
[INSUFFICIENT_STOCK](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebinsufficient_stockbcode) error.
It is raised as some of the [ProductVariant](api-storefront/products/objects/product-variant.mdx)s attached to Checkout don't
have enough stock to finalize the checkout process.
By changing the value of the flag [useLegacyErrorFlow](api-reference/miscellaneous/objects/checkout-settings.mdx#code-style-fontweight-normal-checkoutsettingsbuselegacyerrorflowbcodeboolean--) to `false`,
the errors unrelated to specific actions will not
be raised (as in the above example: mutation [checkoutShippingAddressUpdate](api-storefront/checkout/mutations/checkout-shipping-address-update.mdx) was raising
[INSUFFICIENT_STOCK](api-storefront/checkout/enums/checkout-error-code.mdx#code-style-fontweight-normal-checkouterrorcodebinsufficient_stockbcode) error).
Instead, the new problem will be listed as [Checkout.problems](api-storefront/checkout/objects/checkout.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--)
and [CheckoutLine.problems](api-storefront/checkout/objects/checkout-line.mdx#code-style-fontweight-normal-checkoutbproblemsbcodecheckoutproblem--)
(if the problem is related to the [CheckoutLine](api-storefront/checkout/objects/checkout-line.mdx)).

:::caution

Not all potential problems are already ported to the `problems` field. See the list above. It means that even by
switching [useLegacyErrorFlow](api-reference/miscellaneous/objects/checkout-settings.mdx#code-style-fontweight-normal-checkoutsettingsbuselegacyerrorflowbcodeboolean--)
to `false`, some mutations can raise the error unrelated to the requested action.
The list of supported `problems` will be extended in future releases.

:::

:::note

The flag [useLegacyErrorFlow](api-reference/miscellaneous/objects/checkout-settings.mdx#code-style-fontweight-normal-checkoutsettingsbuselegacyerrorflowbcodeboolean--)
can be modified by updating the
[checkoutSettings](api-reference/channels/inputs/channel-update-input.mdx#code-style-fontweight-normal-channelupdateinputbcheckoutsettingsbcodecheckoutsettingsinput-)
via [channelUpdate](api-reference/channels/mutations/channel-update.mdx) mutation.

The flag [useLegacyErrorFlow](api-reference/miscellaneous/objects/checkout-settings.mdx#code-style-fontweight-normal-checkoutsettingsbuselegacyerrorflowbcodeboolean--)
can be also changed via Saleor-dashboard side.

:::
